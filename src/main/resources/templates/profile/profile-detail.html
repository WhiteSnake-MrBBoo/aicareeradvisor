<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>프로필 상세</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet">

    <style>
        body {
            background-color: #f7f7f7;
        }
        .profile-header-card {
            border-radius: 0.75rem;
        }
        .section-card {
            border-radius: 0.75rem;
        }
        .badge-profile-type {
            font-size: 0.8rem;
        }
    </style>
</head>
<body>

<div class="container py-4">

    <!-- 상단 헤더 -->
    <div class="mb-4">
        <a th:href="@{/profile/list}" class="btn btn-outline-secondary btn-sm">
            ← 진로 상담 프로필 목록이동
        </a>
    </div>

    <div class="card shadow-sm border-0 profile-header-card mb-4" style="border-left: 5px solid #1B56FD !important;">
        <div class="card-body p-4">
            <div class="row align-items-center g-3">

                <div class="col-12 col-md-7">
                    <div class="d-flex align-items-center mb-2">
                        <h3 class="card-title mb-0 fw-bold me-2" th:text="${profileDetail.profileTitle}">진로상담 기본 커리어 프로필</h3>
                        <span class="badge rounded-pill text-bg-primary" th:text="${profileDetail.profileTypeLabel}">ADULT_JOBSEEKER</span>
                    </div>

                    <div class="mb-3">
                        <span class="text-dark fw-semibold"
                              th:text="${profileDetail.displayName}">김부환</span>
                        <span class="text-muted mx-2">|</span>
                        <span class="text-muted"
                              th:text="${profileDetail.email}">email@example.com</span>
                        <span class="badge bg-light text-dark border ms-2"
                              th:text="${profileDetail.userGroup}">ADULT</span>
                    </div>

                    <p class="mb-0 text-secondary italic" style="border-left: 3px solid #dee2e6; padding-left: 10px;">
                        <i class="bi bi-quote"></i>
                        <span th:text="${profileDetail.mainSummary}">7. 프로필 요약 문장이 여기에 표시됩니다.</span>
                    </p>
                </div>

                <div class="col-12 col-md-5 text-md-end">
                    <div class="mb-3 small text-muted">
                        <div><i class="bi bi-calendar-plus"></i> 생성: <span th:text="${#temporals.format(profileDetail.regDate, 'yyyy-MM-dd HH:mm')}">2025-12-19 11:52</span></div>
                        <div><i class="bi bi-pencil-square"></i> 수정: <span th:text="${#temporals.format(profileDetail.modDate, 'yyyy-MM-dd HH:mm')}">2025-12-19 11:52</span></div>
                    </div>

                    <!--AI 추론 아코디언 설계 부분-->
                    <div class="d-flex flex-wrap justify-content-md-end gap-2">
                        <a class="btn btn-primary btn-sm shadow-sm"
                           th:href="@{|/profile/${profileDetail.profileId}/essay|}"
                           style="background-color: #1B56FD; border: none;">
                            <i class="bi bi-magic"></i> 자기 소개서 작성 (AI)
                        </a>

                        <button type="button" class="btn btn-outline-secondary btn-sm" disabled>
                            <i class="bi bi-cpu"></i> AI 커리어 분석 <small>(졸고 있음..)</small>
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- 그리드 레이아웃: 좌측 스킬/가치관/근무환경, 우측 경험/고민 -->

    <div class="row g-4">

        <!-- 좌측 컬럼 -->
        <div class="col-lg-4">

            <!-- 스킬 -->
            <div class="card shadow-sm section-card mb-3">
                <div class="card-body">
                    <h5 class="card-title mb-3">보유 스킬</h5>
                    <div th:if="${#lists.isEmpty(profileDetail.skills)}">
                        <p class="text-muted mb-0">등록된 스킬이 없습니다.</p>
                    </div>
                    <ul class="list-group list-group-flush"
                        th:if="${!#lists.isEmpty(profileDetail.skills)}">
                        <li class="list-group-item"
                            th:each="skill : ${profileDetail.skills}">
                            <div class="d-flex justify-content-between">
                                <span th:text="${skill.skillName}">Java</span>
                                <span class="badge rounded-pill text-bg-light"
                                      th:text="${skill.skillLevel}">INTERMEDIATE</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- 직업 가치관 -->
            <div class="card shadow-sm section-card mb-3">
                <div class="card-body">
                    <h5 class="card-title mb-3">직업 가치관 (Top3)</h5>
                    <div th:if="${#lists.isEmpty(profileDetail.values)}">
                        <p class="text-muted mb-0">선택된 가치관이 없습니다.</p>
                    </div>
                    <ul class="list-group list-group-flush"
                        th:if="${!#lists.isEmpty(profileDetail.values)}">
                        <li class="list-group-item"
                            th:each="val : ${profileDetail.values}">
                            <span class="badge bg-primary me-2"
                                  th:text="${val.priorityOrder}">순위(1~3)</span>
                            <span th:text="${val.valueName}">성장 가능성</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- 선호 근무 환경 -->
            <div class="card shadow-sm section-card">
                <div class="card-body">
                    <h5 class="card-title mb-3">선호 근무 환경</h5>
                    <div th:if="${#lists.isEmpty(profileDetail.workEnvs)}">
                        <p class="text-muted mb-0">선호 근무 환경이 아직 선택되지 않았습니다.</p>
                    </div>
                    <div th:if="${!#lists.isEmpty(profileDetail.workEnvs)}">
                        <span class="badge text-bg-light me-1 mb-1"
                              th:each="env : ${profileDetail.workEnvs}"
                              th:text="${env.workEnvName}">
                            재택/하이브리드
                        </span>
                    </div>
                </div>
            </div>

        </div>

        <!-- 우측 컬럼 -->
        <div class="col-lg-8">

            <!-- 보유 경험 -->
            <div class="card shadow-sm section-card mb-3">
                <div class="card-body">
                    <h5 class="card-title mb-3">보유 경험</h5>

                    <div th:if="${#lists.isEmpty(profileDetail.experiences)}">
                        <p class="text-muted mb-0">등록된 경험 정보가 없습니다.</p>
                    </div>

                    <div class="mb-3"
                         th:each="exp : ${profileDetail.experiences}">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <span class="badge text-bg-info me-2"
                                      th:text="${exp.experienceTypeLabel}">경력 및 역량</span>
                                <strong th:text="${exp.title}">AWS 기반 웹 개발 과정</strong>
                            </div>
                            <small class="text-muted"
                                   th:text="${exp.periodText}">2024.01.01 ~ 2024.06.30 (6개월)</small>
                        </div>
                        <div class="text-muted small" th:text="${exp.organization}">
                            우리인재개발원
                        </div>
                        <p class="mt-2 mb-1 small"
                           th:text="${exp.description}">
                            Java/SpringBoot 기반 프로젝트를 수행하며...
                        </p>
                        <p class="mb-1 small text-success"
                           th:if="${exp.outcome != null}"
                           th:text="'성과: ' + ${exp.outcome}">
                            성과 및 결과 : 프로젝트 완수 및 우수 수료
                        </p>
                        <a th:if="${exp.linkUrl != null}"
                           th:href="${exp.linkUrl}"
                           class="small"
                           target="_blank">
                            URL 주소 : 관련 링크 열기
                        </a>
                        <hr/>
                    </div>
                </div>
            </div>

            <!-- 진로 고민 -->
            <div class="card shadow-sm section-card">
                <div class="card-body">
                    <h5 class="card-title mb-3">취업 진로 선택시 고민</h5>

                    <div th:if="${#lists.isEmpty(profileDetail.concerns)}">
                        <p class="text-muted mb-0">등록된 고민 정보가 없습니다.</p>
                    </div>

                    <ul class="list-group list-group-flush"
                        th:if="${!#lists.isEmpty(profileDetail.concerns)}">
                        <li class="list-group-item"
                            th:each="c : ${profileDetail.concerns}">
                            <strong th:text="${c.concernName}">연봉중요</strong>
                            <div class="small text-muted mt-1"
                                 th:if="${c.detailText != null}"
                                 th:text="${c.detailText}">
                                나이와 연봉 수준에 대한 불안이 있습니다...
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

        </div>
    </div>

    <!-- ============ [아코디언]  AI 기반 결과 / 도구 섹션 ================= -->
    <div class="card mt-4">
        <div class="card-body">
            <h5 class="card-title">AI 기반 결과 & 도구</h5>
            <p class="text-muted mb-3">
                현재 프로필 정보를 기반으로 한 자기소개서, 커리어 분석, Work24 연계 결과를
                이 영역에서 단계적으로 확장해 나갈 예정입니다.
            </p>

            <div class="accordion mt-4" id="aiToolsAccordion">

                <!-- [섹션 1] 자기소개서(AI) -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingEssay">
                        <button class="accordion-button"
                                type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#aiEssaySection"
                                aria-expanded="true"
                                aria-controls="aiEssaySection">
                            <i class="bi bi-magic me-2"></i>
                            자기소개서 초안 (AI)
                            <span class="ms-2 badge bg-light text-dark"
                                  th:if="${essayResult != null}">
                    대표 버전
                </span>
                        </button>
                    </h2>

                    <div id="aiEssaySection"
                         class="accordion-collapse collapse"
                         th:classappend="${essayResult} != null ? ' show' : ''"
                         aria-labelledby="headingEssay"
                         data-bs-parent="#aiToolsAccordion">
                        <div class="accordion-body">

                            <!-- 1) 대표 자소서가 있을 때 -->
                            <div th:if="${essayResult != null}">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <div>
                                        <strong th:text="${essayResult.title != null ? essayResult.title : '대표 자기소개서'}">
                                            대표 자기소개서
                                        </strong>
                                    </div>
                                    <div class="text-muted small">
                            <span th:if="${essayResult.modelName != null}">
                                모델: <span th:text="${essayResult.modelName}">STUB</span>
                            </span>
                                    </div>
                                </div>

                                <pre class="border rounded p-3 bg-light"
                                     style="white-space: pre-wrap; font-size: 0.9rem;"
                                     th:text="${essayResult.rawEssayText}">
                        아직 생성된 자기소개서가 없습니다.
                    </pre>
                            </div>

                            <!-- 2) 대표 자소서가 아직 없을 때 -->
                            <div th:if="${essayResult == null}">
                                <div class="alert alert-info mb-0">
                                    아직 대표 자기소개서가 없습니다.<br>
                                    상단의 <strong>자기소개서 생성 (AI)</strong> 버튼을 눌러
                                    첫 번째 초안을 만들어 보세요.
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!--시작점 / [섹션 1]  - AI 자소서 생성 : 히스토리 영역-->
                <hr class="my-4"/>

                <h6 class="mb-2">
                    <i class="bi bi-clock-history me-1"></i>
                    자기소개서 히스토리
                </h6>

                <div th:if="${#lists.isEmpty(essayHistoryList)}">
                    <p class="text-muted small mb-0">
                        아직 저장된 자기소개서 버전이 없습니다.
                    </p>
                </div>

                <div th:if="${!#lists.isEmpty(essayHistoryList)}" class="table-responsive">
                    <table class="table table-sm align-middle">
                        <thead class="table-light">
                        <tr>
                            <th style="width: 80px;">버전</th>
                            <th>제목</th>
                            <th style="width: 150px;">생성일</th>
                            <th style="width: 120px;">모델</th>
                            <th style="width: 90px;">대표</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="essay : ${essayHistoryList}">
                            <td th:text="${essay.versionNo}">1</td>
                            <td>
                                <span th:text="${essay.title != null ? essay.title : '제목 없음'}">제목 없음</span>
                                <div class="text-muted small"
                                     th:text="${essay.previewText}">
                                    내용 일부 프리뷰
                                </div>
                            </td>
                            <td>
                <span th:text="${#temporals.format(essay.regDate, 'yyyy-MM-dd HH:mm')}">
                    2025-12-24 18:05
                </span>
                            </td>
                            <td th:text="${essay.modelName != null ? essay.modelName : '-'}">
                                STUB
                            </td>
                            <td>
                <span th:if="${essay.main}"
                      class="badge bg-primary">
                    대표
                </span>
                                <span th:if="${!essay.main}"
                                      class="badge bg-secondary">
                    보조
                </span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <!--끝지점 / [섹션 1] - AI 자소서 생성 : 히스토리 영역-->


                <!-- 섹션 2) AI 커리어 분석 V1 (준비 중) -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingCareer">
                        <button class="accordion-button collapsed"
                                type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#aiCareerSection"
                                aria-expanded="false"
                                aria-controls="aiCareerSection">
                            AI 커리어 분석 V1 (준비 중)
                        </button>
                    </h2>
                    <div id="aiCareerSection"
                         class="accordion-collapse collapse"
                         aria-labelledby="headingCareer"
                         data-bs-parent="#aiToolsAccordion">
                        <div class="accordion-body">
                            <p class="text-muted mb-0">
                                프로필의 <strong>스킬, 직업 가치관, 보유 경험</strong>을 기반으로
                                추천 직업군과 액션 플랜을 제안하는 리포트 영역입니다.<br>
                                Work24 API 연동과 함께 구현을 진행할 예정입니다.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- 섹션 3) Work24 심리검사 / 채용정보 피드백 (준비 중) -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingWork24">
                        <button class="accordion-button collapsed"
                                type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#work24Section"
                                aria-expanded="false"
                                aria-controls="work24Section">
                            Work24 심리검사 / 채용정보 피드백 (준비 중)
                        </button>
                    </h2>
                    <div id="work24Section"
                         class="accordion-collapse collapse"
                         aria-labelledby="headingWork24"
                         data-bs-parent="#aiToolsAccordion">
                        <div class="accordion-body">
                            <p class="text-muted mb-0">
                                Work24의 <strong>심리검사 결과, 직업 정보, 채용 정보 API</strong>를 활용하여<br>
                                현재 프로필과의 적합도 및 추가 피드백을 제공할 영역입니다.
                            </p>
                        </div>
                    </div>
                </div>

            </div> <!-- /accordion -->
        </div>
    </div>
    <!-- ============ [아코디언]  AI 기반 결과 / 도구 섹션 ================= -->



</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js">
</script>
</body>
</html>
